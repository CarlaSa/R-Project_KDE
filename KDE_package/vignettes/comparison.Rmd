---
title: "Comparison of Bandwidth Selection Methods"
author: "Charlotte Boys, Leon Patzig, Carla Sagebiel"
description: >
  Simulation study to compare our three bandwidth selection methods.
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Comparison of Bandwidth Selection Methods}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.width = 7,
  fig.height = 4
)
```

```{r, include=FALSE}
devtools::load_all(".")
library(ggplot2)
```

```{r setup}
library(KDE)
```

We run a simulation study to compare the three bandwidth selection methods. I'll use `MLmetrics::MSE(y_pred, y_true)` on the vectors. I'll start with just the Gaussian kernel, then try it for different functions (ask Carla for her functions). I'll find not just the MSE, but also the computation time either using `system.time()`, `Sys.time()` or `utils::Rprof()`.

Um das Resultat nicht von den zuf채llig gezogenen Daten abh채ngig zu machen, m체ssen wir diesen Vorgangmehrere Male (hier meist 400-mal) wiederholen. Damit werden wir Bias und Varianz visualisieren und den MISE ann채hern, um daraus weitere Erkenntnisse abzuleiten

First, let us generate our set of finite data points from a mixed Gaussian distribution:
```{r}
realFunction <- pdfs$Mix2Gauss
data <- rejection_sample(n_obs=1000, realFunction)
```

```{r, echo=FALSE}
plot(data)
```

```{r}
compare <- function(x_points, real_functions, n=1000,  try_kernels=kernels$gaussian, methods="CV", reps=5){
  if(!is.list(try_kernels)) try_kernels <- list(try_kernels)
  if(!is.list(real_functions)) real_functions <- list(real_functions)
  if(!is.list(methods)) methods <- list(methods)
  m <- length(real_functions)*length(try_kernels)*length(methods)
  res <- array(NA, dim=c(length(x_points), reps, m))
  cnt <- 1
  # compare only in the region [0,1]
  #x <- seq(0,1, len=n)
  # iterate through all vectors of options
  for (f in real_functions){
    for (k in try_kernels){
      for (m in methods){
        cat(m, "\n")
        res[,, cnt] <- replicate(reps, {
          data <- rejection_sample(n,f)
          h <- bandwidth_selection(m, k, data, maxEval=1e3, set_up_cluster = F)
          cat("h = ", h, "cnt = ", cnt, "\n")
          KDE <- get_kde(h, k, data)
          KDE(x_points)
        })
        cnt <- cnt + 1
      }
    }
  }
  res
}
```

```{r}


```

```{r}
x_points <- seq(from = -3, to = 3, length.out = 1e2)
f <- pdfs$Cauchy
data1 <- rejection_sample(1000, f)
h_opt <- bandwidth_selection("PCO", data=data1, maxEval=1e3, set_up_cluster = FALSE)
h_opt
```
```{r}
res <- compare(x_points, f, methods=list("CV", "PCO"))
res
